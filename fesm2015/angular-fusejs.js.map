{"version":3,"file":"angular-fusejs.js","sources":["../../src/fusejs.service.ts","../../src/fusejs.pipe.ts","../../src/fusejs.module.ts","../../angular-fusejs.ts"],"sourcesContent":["import {Injectable} from '@angular/core';\nimport * as Fuse from 'fuse.js';\nimport {FuseOptions} from 'fuse.js'\n\nimport {set as _set} from 'lodash-es';\nimport {get as _get} from 'lodash-es';\n\n\nexport interface AngularFusejsOptions<T> extends FuseOptions<T> {\n  supportHighlight?: boolean;\n  fusejsHighlightKey?: string;\n  fusejsScoreKey?: string;\n  minSearchTermLength?: number; // = 0;\n  maximumScore?: number;\n  highlightTag?: string;\n}\n\n@Injectable()\nexport class FusejsService<T> {\n  private defaultOptions: AngularFusejsOptions<T> = {\n    supportHighlight: true,\n    shouldSort: false,\n    threshold: 0.6,\n    location: 0,\n    distance: 100,\n    maxPatternLength: 32,\n    minMatchCharLength: 2,\n    includeScore: true,\n    minSearchTermLength: 3,\n    fusejsHighlightKey: 'fuseJsHighlighted',\n    fusejsScoreKey: 'fuseJsScore',\n  };\n\n  searchList(list: Array<T>, searchTerms: string, options: AngularFusejsOptions<T> = {}) {\n    // https://stackoverflow.com/questions/35959372/property-assign-does-not-exist-on-type-objectconstructor\n    // TODO : remove (<any>Object) hack by using right lib or polyfill ?\n    const fuseOptions: AngularFusejsOptions<T> = (<any>Object).assign({}, this.defaultOptions, options);\n    let result:any = [];\n\n    if (searchTerms && searchTerms.length >= (fuseOptions?.minSearchTermLength || 0)) {\n      if (fuseOptions.supportHighlight) {\n        fuseOptions.includeMatches = true;\n      }\n\n      let fuse = new Fuse(list, fuseOptions);\n      result = fuse.search(searchTerms);\n      if (fuseOptions.supportHighlight) {\n        result = this.handleHighlight(result, fuseOptions);\n      }\n    } else {\n      result = this.deepClone(list);\n\n      if (fuseOptions.supportHighlight) {\n        result.forEach((element) => {\n          element[fuseOptions.fusejsHighlightKey || '_'] = this.deepClone(element);\n        });\n      }\n    }\n\n    return result;\n  }\n\n  private deepClone(o) {\n    var _out, v, _key;\n    _out = Array.isArray(o) ? [] : {};\n    for (_key in o) {\n      v = o[_key];\n      _out[_key] = (typeof v === \"object\") ? this.deepClone(v) : v;\n    }\n    return _out;\n  }\n\n  private handleHighlight(result, options: AngularFusejsOptions<T>) {\n    if (options.maximumScore && options.includeScore) {\n      result = result.filter((matchObject) => {\n        return matchObject.score <= (options.maximumScore||0);\n      })\n    }\n\n    return result.map((matchObject) => {\n      const item = this.deepClone(matchObject.item);\n      item[options.fusejsHighlightKey || \"_\"] = this.deepClone(item);\n      item[options.fusejsScoreKey || \"_\"] = matchObject.score;\n      for (let match of matchObject.matches) {\n        const indices: number[][] = match.indices;\n\n        let highlightOffset: number = 0;\n\n        let key: string = match.key;\n        if(_get(item[options.fusejsHighlightKey || \"_\"], key).constructor === Array) {\n          key += `[${match.arrayIndex}]`\n        }\n\n        for (let indice of indices) {\n          let initialValue: string = _get(item[options.fusejsHighlightKey || \"_\"], key) as string;\n\n          const startOffset = indice[0] + highlightOffset;\n          const endOffset = indice[1] + highlightOffset + 1;\n          const tagStart = \"<\" + (options.highlightTag ?? \"em\") + \">\";\n          const tagEnd = \"</\" + (options.highlightTag ?? \"em\") + \">\";\n          let highlightedTerm = initialValue.substring(startOffset, endOffset);\n          let newValue = initialValue.substring(0, startOffset) + tagStart + highlightedTerm + tagEnd + initialValue.substring(endOffset);\n          highlightOffset += (tagStart + tagEnd).length;\n          _set(item[options.fusejsHighlightKey || \"_\"], key, newValue);\n        }\n      }\n\n      return item;\n    });\n  }\n}\n","import { Pipe, PipeTransform } from '@angular/core';\nimport {FusejsService, AngularFusejsOptions} from './fusejs.service';\n\n\n@Pipe({name: 'fusejs'})\nexport class FusejsPipe<T> implements PipeTransform {\n  constructor(\n    private FusejsService: FusejsService<T>\n  ) {}\n\n  transform(elements: Array<T>,\n            searchTerms: string,\n            options: AngularFusejsOptions<T> = {}) {\n    return this.FusejsService.searchList(elements, searchTerms, options);\n  }\n}\n","import { NgModule } from '@angular/core'\nimport { FusejsPipe } from './fusejs.pipe'\nimport { FusejsService } from './fusejs.service'\n\n@NgModule({\n  providers: [\n    FusejsService\n  ],\n  declarations: [\n    FusejsPipe,\n  ],\n  exports: [\n    FusejsPipe,\n  ]\n})\nexport class FusejsModule {};\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":["_get","_set"],"mappings":"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"}